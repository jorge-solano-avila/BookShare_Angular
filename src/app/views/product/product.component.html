<div class = "container custom-white-background">
	<div>
		<h1>Producto</h1>
		<div class = "col-md-offset-2 col-md-8">
			<form [formGroup] = "productForm" (ngSubmit) = "save()">
				<div class = "panel panel-primary">
					<div class = "panel-heading">
						<h3 class = "panel-title">Información del título</h3>
					</div>
					<div class = "panel-body">
						<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.name.touched ) && productForm.controls.name.invalid }">
							<label>Nombre</label>
							<span *ngIf = "mode === 'view'">{{ product.productItem.name }}</span>
							<div *ngIf = "mode !== 'view'">
								<input class = "form-control" type = "text" formControlName = "name" [(ngModel)] = "product.productItem.name">

								<div *ngIf = "( submitted || productForm.controls.name.touched ) && productForm.controls.name.invalid" class = "alert alert-danger">
									<div [hidden] = "!productForm.controls.name.errors.required">
										El nombre es requerido
									</div>
								</div>
							</div>
						</div>

						<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.author.touched ) && productForm.controls.author.invalid }">
							<label>Autor</label>
							<span *ngIf = "mode === 'view'">{{ product.productItem.author }}</span>
							<div *ngIf = "mode !== 'view'">
								<input class = "form-control" type = "text" formControlName = "author" [(ngModel)] = "product.productItem.author">

								<div *ngIf = "( submitted || productForm.controls.author.touched ) && productForm.controls.author.invalid" class = "alert alert-danger">
									<div [hidden] = "!productForm.controls.author.errors.required">
										El autor es requerido
									</div>
								</div>
							</div>
						</div>

						<div class = "form-inline">
							<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.genre.touched ) && productForm.controls.genre.invalid }">
								<label>Género</label>
								<span *ngIf = "mode === 'view'">{{ product.productItem.genre.name }}</span>
								<div *ngIf = "mode !== 'view'">
									<input class = "form-control" formControlName = "genre" [(ngModel)] = "product.productItem.genre.name" [typeahead] = "genres" typeaheadOptionField = "name">

									<div *ngIf = "( submitted || productForm.controls.genre.touched ) && productForm.controls.genre.invalid" class = "alert alert-danger">
										<div [hidden] = "!productForm.controls.genre.errors.required">
											El género es requerido
										</div>
									</div>
								</div>
							</div>

							<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.yearOfPublication.touched ) && productForm.controls.yearOfPublication.invalid }">
								<label>Año de publicación</label>
								<span *ngIf = "mode === 'view'">{{ product.productItem.yearOfPublication }}</span>
								<div *ngIf = "mode !== 'view'">
									<input class = "form-control" type = "number" formControlName = "yearOfPublication" [(ngModel)] = "product.productItem.yearOfPublication">

									<div *ngIf = "( submitted || productForm.controls.yearOfPublication.touched ) && productForm.controls.yearOfPublication.invalid" class = "alert alert-danger">
										<div [hidden] = "!productForm.controls.yearOfPublication.errors.required">
											El año de publicación es requerido
										</div>
										<div [hidden] = "!productForm.controls.yearOfPublication.errors.maxValue">
											El año de publicación no puede ser mayor al año actual
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.editorial.touched ) && productForm.controls.editorial.invalid }">
							<label>Editorial</label>
							<span *ngIf = "mode === 'view'">{{ product.productItem.editorial }}</span>
							<div *ngIf = "mode !== 'view'">
								<input class = "form-control" type = "text" formControlName = "editorial" [(ngModel)] = "product.productItem.editorial">

								<div *ngIf = "( submitted || productForm.controls.editorial.touched ) && productForm.controls.editorial.invalid" class = "alert alert-danger">
									<div [hidden] = "!productForm.controls.editorial.errors.required">
										La editorial es requerida
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class = "panel panel-primary">
					<div class = "panel-heading">
						<h3 class = "panel-title">Información del producto</h3>
					</div>
					<div class = "panel-body">
						<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.type.touched ) && productForm.controls.type.invalid }">
							<label>Tipo de producto</label>
							<span *ngIf = "mode === 'view'">{{ typeTexts[product.productItem.type] }}</span>
							<div *ngIf = "mode !== 'view'">
								<select class = "form-control" formControlName = "type" [(ngModel)] = "product.productItem.type">
									<option *ngFor = "let type of types" [ngValue] = "typeValues[type]">{{ type }}</option>
								</select>

								<div *ngIf = "( submitted || productForm.controls.type.touched ) && productForm.controls.type.invalid" class = "alert alert-danger">
									<div [hidden] = "!productForm.controls.type.errors.required">
										El tipo de producto es requerido
									</div>
								</div>
							</div>
						</div>

						<div class = "form-inline">
							<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.code.touched ) && productForm.controls.code.invalid }">
								<label>Tipo de código (ISBN, ASIN, ...)</label>
								<span *ngIf = "mode === 'view'">{{ product.code }}</span>
								<div *ngIf = "mode !== 'view'">
									<input class = "form-control" type = "text" formControlName = "code" [(ngModel)] = "product.code">

									<div *ngIf = "( submitted || productForm.controls.code.touched ) && productForm.controls.code.invalid" class = "alert alert-danger">
										<div [hidden] = "!productForm.controls.code.errors.required">
											El código es requerido
										</div>
									</div>
								</div>
							</div>

							<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.codeType.touched ) && productForm.controls.codeType.invalid }">
								<label>Código</label>
								<span *ngIf = "mode === 'view'">{{ product.codeType }}</span>
								<div *ngIf = "mode !== 'view'">
									<input class = "form-control" type = "text" formControlName = "codeType" [(ngModel)] = "product.codeType">

									<div *ngIf = "( submitted || productForm.controls.codeType.touched ) && productForm.controls.codeType.invalid" class = "alert alert-danger">
										<div [hidden] = "!productForm.controls.codeType.errors.required">
											El tipo de código es requerido
										</div>
									</div>
								</div>
							</div>
						</div>
					
						<div *ngIf = "mode !== 'view' || ( mode === 'view' && product.description && product.description.length > 0 )" class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.description.touched ) && productForm.controls.description.invalid }">
							<label>Descripción</label>
							<span *ngIf = "mode === 'view'">{{ product.description }}</span>
							<div *ngIf = "mode !== 'view'">
								<textarea class = "form-control" rows = "3" formControlName = "description" [(ngModel)] = "product.description"></textarea>

								<div *ngIf = "( submitted || productForm.controls.description.touched ) && productForm.controls.description.invalid" class = "alert alert-danger">
									<div [hidden] = "!productForm.controls.description.errors.maxlength">
										La descripción sólo puede tener 1000 caracteres
									</div>
								</div>
							</div>
						</div>

						<div class = "form-inline">
							<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.cover.touched ) && productForm.controls.cover.invalid }">
								<label>Cubierta</label>
								<span *ngIf = "mode === 'view'">{{ covers[product.cover - 1] }}</span>
								<div *ngIf = "mode !== 'view'">
									<select class = "form-control" formControlName = "cover" [(ngModel)] = "product.cover">
										<option *ngFor = "let cover of covers; let i = index" [ngValue] = "i + 1">{{ cover }}</option>
									</select>

									<div *ngIf = "( submitted || productForm.controls.cover.touched ) && productForm.controls.cover.invalid" class = "alert alert-danger">
										<div [hidden] = "!productForm.controls.cover.errors.required">
											La cubierta es requerida
										</div>
									</div>
								</div>
							</div>

							<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.status.touched ) && productForm.controls.status.invalid }">
								<label>Estado</label>
								<span *ngIf = "mode === 'view'">{{ statuses[product.status - 1] }}</span>
								<div *ngIf = "mode !== 'view'">
									<select class = "form-control" formControlName = "status" [(ngModel)] = "product.status">
										<option *ngFor = "let status of statuses; let i = index" [ngValue] = "i + 1">{{ status }}</option>
									</select>

									<div *ngIf = "( submitted || productForm.controls.status.touched ) && productForm.controls.status.invalid" class = "alert alert-danger">
										<div [hidden] = "!productForm.controls.status.errors.required">
											El estado es requerido
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class = "form-group" [ngClass] = "{ 'has-error': ( submitted || productForm.controls.value.touched ) && productForm.controls.value.invalid }">
							<label>Valor del producto</label>
							<span *ngIf = "mode === 'view'">{{ product.value | currency: 'COP': true }}</span>
							<div *ngIf = "mode !== 'view'">
								<input class = "form-control" type = "number" formControlName = "value" [(ngModel)] = "product.value">

								<div *ngIf = "( submitted || productForm.controls.value.touched ) && productForm.controls.value.invalid" class = "alert alert-danger">
									<div [hidden] = "!productForm.controls.value.errors.required">
										El valor es requerido
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<button *ngIf = "mode !== 'view'" class = "btn btn-primary btn-lg btn-block" type = "submit">Guardar</button>
			</form>
		</div>
	</div>
</div>